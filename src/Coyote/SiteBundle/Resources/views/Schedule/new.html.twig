{% extends 'CoyoteSiteBundle:Schedule:index.html.twig' %}

{% block javascripts %}
    <!--[if IE]>
        <script src="{{ asset('bundles/coyotesite/js/jquery-min.js') }}"/></script>
        <script src="{{ asset('bundles/coyotesite/js/jquery.js') }}"></script>
        <script src="{{ asset('bundles/coyotesite/js/script_timeusers_ie.js') }}"></script>
        <script src="{{ asset('bundles/coyotesite/js/script_timeusers_change.js') }}"/></script>
    <![endif]-->
    <!--[if !IE]><!-->
        <script src="{{ asset('bundles/coyotesite/js/jquery-min.js') }}"/></script>
        <script src="{{ asset('bundles/coyotesite/js/jquery.js') }}"></script>
        {% if is_granted('ROLE_TECH') %}
        <script src="{{ asset('bundles/coyotesite/js/script_timeusers.js') }}"/></script>
        <script src="{{ asset('bundles/coyotesite/js/script_timeusers_change.js') }}"/></script>
        {% endif %}
        {% if is_granted('ROLE_CADRE') %}
        <script src="{{ asset('bundles/coyotesite/js/script_timeframework.js') }}"/></script>
        <script src="{{ asset('bundles/coyotesite/js/script_timeframework_change.js') }}"/></script>
        {% endif %}
    <!--<![endif]-->
{% endblock %}

{% block content %}

    {% for flashMessage in app.session.flashbag.get('save_schedule') %}
        {% set message = flashMessage %}
        {% if message == "schedule.flash.save" %}
            <p id="flashmessage_valid">{{ flashMessage|trans }}</p>
        {% elseif message == "schedule.flash.no_save" %}
            <p id="flashmessage_error">{{ flashMessage|trans }}</p>
        {% endif %}
    {% endfor %}

    {% if is_granted('ROLE_TECH') %}
        <form role="form" action="{{ path('schedule_savetime') }}" method='post'>
            <p id="titreconfig">
                <b>{{'schedule.title.new'|trans}} - </b>
                {{'schedule.message_week'|trans({'%no_week%': app.session.get('week'), '%year%': app.session.get('year')})}}
            </p>
            <div class='table-responsive'>
        	    <table id='table_temps' class='table'>
                    <thead>
        		    	<tr>
            				<td>{{'schedule.dayofweek'|trans}}</td>
            				<td>{{'schedule.start'|trans}}</td>
            				<td>{{'schedule.end'|trans}}</td>
            				<td>{{'schedule.break'|trans}}</td>
            				<td>{{'schedule.working_time'|trans}}</td>
            				<td>{{'schedule.travel'|trans}}</td>
            				<td>{{'schedule.absence'|trans}}</td>
            				<td>{{'schedule.absence_time'|trans}}</td>
            				<td>{{'schedule.comment'|trans}}</td>
                        </tr>
                    </thead>
                    <tbody>

                    {% for key,date in data_timetable %}
                        <tr>
            				<td class='jour'>{{ "schedule#{loop.index}"|trans }} :
            				    <input class='input' type='text' readonly name="date{{loop.index}}" id="date{{loop.index}}" value={{ date.date|date("d/m/Y") }} />
            				</td>
            				<td>

            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).start %}
            				        <input class='input' type='time' name="debut{{loop.index}}" id="debut{{loop.index}}" maxlength='5' data-value={{ attribute(time,loop.index0).start }} value={{ attribute(time,loop.index0).start }} />
            				    {% else %}
            				        <input class='input' type='time' name="debut{{loop.index}}" id="debut{{loop.index}}" maxlength='5'>
            				    {% endif %}
            				</td>
            				<td>
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).end %}
            				        <input class='input' type='time' name='fin{{loop.index}}' id='fin{{loop.index}}' maxlength='5' data-value={{ attribute(time,loop.index0).end }} value={{ attribute(time,loop.index0).end }} />
            				    {% else %}
            				        <input class='input' type='time' name="fin{{loop.index}}" id="fin{{loop.index}}" maxlength='5' />
            				    {% endif %}
            				</td>
            				<td>
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).break %}
            				        <input class='input' type='time' name='pause{{loop.index}}' id='pause{{loop.index}}' maxlength='5' data-value={{ attribute(time,loop.index0).break }} value={{ attribute(time,loop.index0).break }} />
            				    {% else %}
            				        <input class='input' type='time' name="pause{{loop.index}}" id="pause{{loop.index}}" maxlength='5' />
            				    {% endif %}
            				</td>
            				<td>
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).workingtime %}
            				        <input class='input' type='text' name='tps{{loop.index}}' id='tps{{loop.index}}' disabled data-value={{ attribute(time,loop.index0).workingtime }} value={{ attribute(time,loop.index0).workingtime }} />
            				    {% else %}
            				        <input class='input' type='text' name="tps{{loop.index}}" id="tps{{loop.index}}" readonly />
            				    {% endif %}
            				</td>
            				<td class='deplacement'>
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).travel %}
            				        <input type="checkbox" name='deplacement{{loop.index}}' id='deplacement{{loop.index}}' data-value={{ attribute(time,loop.index0).travel }} >
            				    {% else %}
            				        <input type="checkbox" name="deplacement{{loop.index}}" id="deplacement{{loop.index}}">
            				    {% endif %}
            				</td>
            				<td class="selectabsence">
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).absencename %}
            				        <select name='absence{{loop.index}}' id='absence{{loop.index}}' data-value={{ attribute(time,loop.index0).absencename }} >
            				    {% else %}
            					   <select name="absence{{loop.index}}" id="absence{{loop.index}}" >
            					{% endif %}
                					<option value='Aucune'></option>
                					<option value='RTT'>{{'schedule.rtt'|trans}}</option>
                					<option value='CP'>{{'schedule.cp'|trans}}</option>
                					<option value='CA'>{{'schedule.ca'|trans}}</option>
                					<option value='CSS'>{{'schedule.css'|trans}}</option>
                					<option value="AT">{{'schedule.at'|trans}}</option>
                					<option value="MP">{{'schedule.mp'|trans}}</option>
                					<option value="Recup">{{'schedule.recup'|trans}}</option>
                					<option value="Autre">{{'schedule.various'|trans}}</option>
            					</select>
            				</td>
            				<td class='absenceday' >
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).absenceduration %}
            				        <select name='absenceday{{loop.index}}' id='absenceday{{loop.index}}' data-value={{attribute(time,loop.index0).absenceduration}} >
            				    {% else %}
            					   <select name="absenceday{{loop.index}}" id="absenceday{{loop.index}}" >
            				    {% endif %}
            					    <option value="empty"></option>
            					    <option value='0.5'>{{'0,5'|trans}}</option>
                                    <option value='1'>{{'1'|trans}}</option>
            					</select>
            					<input class='input' type='text' name="absencetime{{loop.index}}" id="absencetime{{loop.index}}" maxlength='5' />
            				</td>
            				<td>
            				    {% if attribute(time,loop.index0) is not empty and attribute(time,loop.index0).comment %}
            				        <input type='text' name='commentaire{{loop.index}}' id='commentaire{{loop.index}}' placeholder="{{'schedule.write_comment'|trans}}" data-value={{ attribute(time,loop.index0).comment }} value="{{ attribute(time,loop.index0).comment }}" />
            				    {% else %}
            				        <input type='text' name="commentaire{{loop.index}}" id="commentaire{{loop.index}}" placeholder='{{'schedule.write_comment'|trans}}' value='' />
            				    {% endif %}
            				</td>
            			</tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <button class='btnsave' type="submit" value="Enregistrer" id="enregistrer">{{ 'schedule.submit.save'|trans }}</button>
        </form>

    {% endif %}

{% endblock content %}