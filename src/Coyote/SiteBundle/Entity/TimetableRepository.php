<?php

namespace Coyote\SiteBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * TimetableRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class TimetableRepository extends EntityRepository
{
    /**
     * find shedule id
     *
     * @access public
     * @param mixed $no_week
     * @param mixed $year
     * @param mixed $user_id
     * @return array schedule id
     */
    public function myFindScheduleId($no_week, $year, $user_id)
    {
        $qb = $this->_em->createQueryBuilder();
        $qb->select('s.id')
           ->from('CoyoteSiteBundle:Schedule', 's')
           ->innerJoin('CoyoteSiteBundle:Timetable', 't', 'WITH', 't.id = s.timetable')
           ->where('s.user = :user and t.year = :year and t.no_week = :no_week')
           ->setParameters(array('user' => $user_id, 'year' => $year, 'no_week' => $no_week));
        $id_schedule =  $qb->getQuery()
                           ->getResult();

        return $id_schedule;
    }

    /**
     * find timetable id.
     *
     * @access public
     * @param mixed $no_week
     * @param mixed $year
     * @return array timetable id
     */
    public function myFindTimetableId($no_week, $year)
    {
        $qb = $this->_em->createQueryBuilder();
        $qb->select('t.id')
           ->from('CoyoteSiteBundle:Timetable', 't')
           ->where('t.no_week = :no_week and t.year = :year')
           ->setParameters(array('no_week' => $no_week, 'year' => $year));
        $timetable_id =  $qb->getQuery()
                            ->getResult();

        return $timetable_id;
    }

    /**
     * find period respect to date function.
     *
     * @access public
     * @param mixed $date
     * @return timetable pay_period
     */
    public function findPeriodByDate($date)
    {
        $qb = $this->_em->createQueryBuilder();
        $qb->select('t.pay_period')
           ->from('CoyoteSiteBundle:Timetable', 't')
           ->where('t.date = :date')
           ->setParameters(array('date' => $date));
        return $qb->getQuery()->getSingleScalarResult();
    }
}
